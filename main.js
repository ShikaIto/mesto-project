(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","true"))}e.d({},{k:()=>G});var n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"df2a87c1-ee4d-42a8-8cbf-5bf5b4af8b77","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r,c,a=document.querySelector(".cards__list"),i=document.querySelector("#popup-image"),s=document.querySelector(".popup__image"),u=document.querySelector(".popup__image-caption"),l={};function d(e,t){e.prepend(t)}function p(e,t,a,p,f){var v,_=document.querySelector("#card-template").content.querySelector(".cards__item").cloneNode(!0),h=_.querySelector(".cards__image"),b=_.querySelector(".cards__like-counter"),y=_.querySelector(".cards__like-button");h.setAttribute("src",e),_.querySelector(".cards__title").textContent=t,h.setAttribute("alt",t),b.textContent=f.length,f.forEach((function(e){e._id===G&&y.classList.add("cards__like-button_active")})),l[e]=a,p===G&&d(_,((v=document.createElement("button")).classList.add("cards__delete-button"),v.setAttribute("type","button"),v)),h.addEventListener("click",(function(){C(i),u.textContent=t,s.setAttribute("src",e),s.setAttribute("alt",t)})),y.addEventListener("click",(function(){y.classList.toggle("cards__like-button_active"),function(e,t,r){t.classList.contains("cards__like-button_active")?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(o).catch((function(e){console.log(e)}))}(r).then((function(t){e.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(o).catch((function(e){console.log(e)}))}(r).then((function(t){e.textContent=t.likes.length})).catch((function(e){console.log(e)}))}(b,y,a)}));var q=_.querySelector(".cards__delete-button");return q&&q.addEventListener("click",(function(e){r=e.target.closest(".cards__item"),c=l[r.querySelector(".cards__image").src],S.classList.add("popup_opened"),document.addEventListener("keydown",L),E.addEventListener("click",m)})),_}function m(){var e;r.remove(),e=c,fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(o).catch((function(e){console.log(e)})),q(S),E.removeEventListener("click",m)}var f=document.querySelector("#popup-add"),v=document.querySelector("#popup-edit"),_=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__edit-button"),b=document.querySelector("#popup-avatar"),y=document.querySelector(".profile__avatar-button"),S=document.querySelector("#popup-delete"),E=S.querySelector(".popup__submit");function L(e){"Escape"===e.key&&q(document.querySelector(".popup_opened"))}function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",L)}function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",L)}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close-button"))&&q(e)}))})),_.addEventListener("click",(function(){C(f)})),h.addEventListener("click",(function(){C(v)})),y.addEventListener("click",(function(){C(b)}));var g=document.forms.edit,k=document.forms.avatar,A=document.forms.add,x=A.elements.image,U=A.elements.name,T=g.elements.name,w=g.elements.job,O=k.elements.image,P=document.querySelector(".profile__avatar-container"),j=document.querySelector(".profile__avatar-button"),B=document.querySelector(".profile__name"),D=document.querySelector(".profile__caption"),N=document.querySelector(".profile__avatar"),J={inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"},G="";!function(e){Array.from(document.forms).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){t(o,r,n),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n)}))}))}(n,e)}))}(J),P.addEventListener("mouseover",(function(){j.style.visibility="visible"})),P.addEventListener("mouseout",(function(){j.style.visibility="hidden"})),g.addEventListener("submit",(function(e){e.preventDefault();var t,r,c=g.elements.submit;c.textContent="Coхранение...",B.textContent=T.value,D.textContent=w.value,(t=T.value,r=w.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:t,about:r})}).then(o)).then((function(){q(v),c.textContent="Сохранить"})).catch((function(e){console.log(e)}))})),A.addEventListener("submit",(function(e){e.preventDefault();var r,c,i=A.elements.submit;i.textContent="Coхранение...",(r=U.value,c=x.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:r,link:c})}).then(o)).then((function(e){d(a,p(e.link,e.name,e._id,e.owner._id,e.likes))})).then((function(){q(f),A.reset(),i.textContent="Создать"})).catch((function(e){console.log(e)})),t(Array.from(A.querySelectorAll(J.inputSelector)),i,J)})),k.addEventListener("submit",(function(e){e.preventDefault();var r=k.elements.submit;r.textContent="Coхранение...",N.setAttribute("src",O.value),function(e){return fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:e})}).then(o)}(O.value).then((function(){q(b),k.reset(),r.textContent="Сохранить"})).catch((function(e){console.log(e)})),t(Array.from(k.querySelectorAll(J.inputSelector)),r,J)})),fetch("".concat(n.baseUrl,"/users/me"),{method:"GET",headers:n.headers}).then(o).then((function(e){return B.textContent=e.name,D.textContent=e.about,N.src=e.avatar,T.value=e.name,w.value=e.about,e._id})).then((function(e){G=e})).catch((function(e){console.log(e)})),fetch("".concat(n.baseUrl,"/cards"),{method:"GET",headers:n.headers}).then(o).then((function(e){e.forEach((function(e){d(a,p(e.link,e.name,e._id,e.owner._id,e.likes))}))})).catch((function(e){console.log(e)}))})();