(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","true"))}e.d({},{VW:()=>k,dC:()=>A,BD:()=>T,e0:()=>U,j0:()=>x});var n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"df2a87c1-ee4d-42a8-8cbf-5bf5b4af8b77","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r=document.querySelector(".cards__list"),c=document.querySelector("#popup-image"),a=document.querySelector(".popup__image"),s=document.querySelector(".popup__image-caption"),u={},i="";function l(e,t){e.prepend(t)}function d(e,t,r,d,p){var m,f=document.querySelector("#card-template").content.querySelector(".cards__item").cloneNode(!0),v=f.querySelector(".cards__image"),_=f.querySelector(".cards__like-counter"),b=f.querySelector(".cards__like-button");v.setAttribute("src",e),f.querySelector(".cards__title").textContent=t,v.setAttribute("alt",t),_.textContent=p.length,p.forEach((function(e){e._id===i&&b.classList.add("cards__like-button_active")})),u[e]=r,d!==i&&void 0!==d||l(f,((m=document.createElement("button")).classList.add("cards__delete-button"),m.setAttribute("type","button"),m)),v.addEventListener("click",(function(){L(c),s.textContent=t,a.setAttribute("src",e),a.setAttribute("alt",t)})),b.addEventListener("click",(function(){b.classList.toggle("cards__like-button_active"),function(e,t,r){t.classList.contains("cards__like-button_active")?function(e,t){fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(o).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(r,e):function(e,t){fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(o).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(r,e)}(_,b,r)}));var q=f.querySelector(".cards__delete-button");return q&&q.addEventListener("click",(function(e){var t=e.target.closest(".cards__item"),r=t.querySelector(".cards__image").src;!function(e,t,r){e.classList.add("popup_opened"),document.addEventListener("keydown",S),y.addEventListener("click",(function(){!function(e,t){e.remove(),function(e){fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(o).catch((function(e){console.log(e)}))}(t)}(t,r),E(h)}))}(h,t,u[r])})),f}var p=document.querySelector("#popup-add"),m=document.querySelector("#popup-edit"),f=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__edit-button"),_=document.querySelector("#popup-avatar"),b=document.querySelector(".profile__avatar-button"),h=document.querySelector("#popup-delete"),y=h.querySelector(".popup__submit");function S(e){"Escape"===e.key&&E(document.querySelector(".popup_opened"))}function E(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)}function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close-button"))&&E(e)}))})),f.addEventListener("click",(function(){L(p)})),v.addEventListener("click",(function(){L(m)})),b.addEventListener("click",(function(){L(_)}));var q=document.forms.edit,C=document.forms.avatar,g=document.forms.add,k=g.elements.image,A=g.elements.name,x=q.elements.name,U=q.elements.job,T=C.elements.image,j=document.querySelector(".profile__avatar-container"),O=document.querySelector(".profile__avatar-button"),P=document.querySelector(".profile__name"),w=document.querySelector(".profile__caption"),B=document.querySelector(".profile__avatar"),D={inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"};!function(e){Array.from(document.forms).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){t(o,r,n),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n)}))}))}(n,e)}))}(D),j.addEventListener("mouseover",(function(){O.style.visibility="visible"})),j.addEventListener("mouseout",(function(){O.style.visibility="hidden"})),q.addEventListener("submit",(function(e){e.preventDefault();var t=q.elements.submit;t.textContent="Coхранение...",P.textContent=x.value,w.textContent=U.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:x.value,about:U.value})}),E(m),t.textContent="Сохранить"})),g.addEventListener("submit",(function(e){e.preventDefault();var o=g.elements.submit;o.textContent="Coхранение...",l(r,d(k.value,A.value)),fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:A.value,link:k.value})}),E(p),o.textContent="Создать",g.reset(),t(Array.from(g.querySelectorAll(D.inputSelector)),o,D)})),C.addEventListener("submit",(function(e){e.preventDefault();var o=C.elements.submit;o.textContent="Coхранение...",B.setAttribute("src",T.value),fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:T.value})}),E(_),o.textContent="Сохранить",C.reset(),t(Array.from(C.querySelectorAll(D.inputSelector)),o,D)})),function(e,t,r){fetch("".concat(n.baseUrl,"/users/me"),{method:"GET",headers:n.headers}).then(o).then((function(n){var o;e.textContent=n.name,t.textContent=n.about,r.src=n.avatar,o=n._id,i=o,x.value=n.name,U.value=n.about})).catch((function(e){console.log(e)}))}(P,w,B),fetch("".concat(n.baseUrl,"/cards"),{method:"GET",headers:n.headers}).then(o).then((function(e){e.forEach((function(e){l(r,d(e.link,e.name,e._id,e.owner._id,e.likes))}))})).catch((function(e){console.log(e)}))})();