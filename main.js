(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","true"))}e.d({},{VW:()=>g,dC:()=>k,BD:()=>U,e0:()=>x,j0:()=>A,kW:()=>D});var n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"df2a87c1-ee4d-42a8-8cbf-5bf5b4af8b77","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var r=document.querySelector(".cards__list"),c=document.querySelector("#popup-image"),a=document.querySelector(".popup__image"),u=document.querySelector(".popup__image-caption"),s={};function i(e,t){e.prepend(t)}function l(e,t,r,l,d){var p,m=document.querySelector("#card-template").content.querySelector(".cards__item").cloneNode(!0),f=m.querySelector(".cards__image"),v=m.querySelector(".cards__like-counter"),_=m.querySelector(".cards__like-button");f.setAttribute("src",e),m.querySelector(".cards__title").textContent=t,f.setAttribute("alt",t),r&&(v.textContent=d.length,d.forEach((function(e){e._id===D&&_.classList.add("cards__like-button_active")})),s[e]=r),l!==D&&l||i(m,((p=document.createElement("button")).classList.add("cards__delete-button"),p.setAttribute("type","button"),p)),f.addEventListener("click",(function(){E(c),u.textContent=t,a.setAttribute("src",e),a.setAttribute("alt",t)})),_.addEventListener("click",(function(){_.classList.toggle("cards__like-button_active"),function(e,t,r){t.classList.contains("cards__like-button_active")?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(o)}(r).then((function(t){e.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then(o)}(r).then((function(t){e.textContent=t.likes.length})).catch((function(e){console.log(e)}))}(v,_,r)}));var L=m.querySelector(".cards__delete-button");return L&&L.addEventListener("click",(function(e){var t=e.target.closest(".cards__item"),r=t.querySelector(".cards__image").src;!function(e,t,r){e.classList.add("popup_opened"),document.addEventListener("keydown",y),h.addEventListener("click",(function(){!function(e,t){e.remove(),function(e){fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(o).catch((function(e){console.log(e)}))}(t)}(t,r),S(b)}))}(b,t,s[r])})),m}var d=document.querySelector("#popup-add"),p=document.querySelector("#popup-edit"),m=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__edit-button"),v=document.querySelector("#popup-avatar"),_=document.querySelector(".profile__avatar-button"),b=document.querySelector("#popup-delete"),h=b.querySelector(".popup__submit");function y(e){"Escape"===e.key&&S(document.querySelector(".popup_opened"))}function S(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",y)}function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",y)}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close-button"))&&S(e)}))})),m.addEventListener("click",(function(){E(d)})),f.addEventListener("click",(function(){E(p)})),_.addEventListener("click",(function(){E(v)}));var L=document.forms.edit,q=document.forms.avatar,C=document.forms.add,g=C.elements.image,k=C.elements.name,A=L.elements.name,x=L.elements.job,U=q.elements.image,T=document.querySelector(".profile__avatar-container"),j=document.querySelector(".profile__avatar-button"),O=document.querySelector(".profile__name"),P=document.querySelector(".profile__caption"),w=document.querySelector(".profile__avatar"),B={inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"},D="";!function(e){Array.from(document.forms).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){t(o,r,n),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n)}))}))}(n,e)}))}(B),T.addEventListener("mouseover",(function(){j.style.visibility="visible"})),T.addEventListener("mouseout",(function(){j.style.visibility="hidden"})),L.addEventListener("submit",(function(e){e.preventDefault();var t=L.elements.submit;t.textContent="Coхранение...",O.textContent=A.value,P.textContent=x.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:A.value,about:x.value})}),S(p),t.textContent="Сохранить"})),C.addEventListener("submit",(function(e){e.preventDefault();var o=C.elements.submit;o.textContent="Coхранение...",i(r,l(g.value,k.value)),fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:k.value,link:g.value})}),S(d),o.textContent="Создать",C.reset(),t(Array.from(C.querySelectorAll(B.inputSelector)),o,B)})),q.addEventListener("submit",(function(e){e.preventDefault();var o=q.elements.submit;o.textContent="Coхранение...",w.setAttribute("src",U.value),fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:U.value})}),S(v),o.textContent="Сохранить",q.reset(),t(Array.from(q.querySelectorAll(B.inputSelector)),o,B)})),fetch("".concat(n.baseUrl,"/users/me"),{method:"GET",headers:n.headers}).then(o).then((function(e){return O.textContent=e.name,P.textContent=e.about,w.src=e.avatar,A.value=e.name,x.value=e.about,e._id})).then((function(e){D=e})).catch((function(e){console.log(e)})),fetch("".concat(n.baseUrl,"/cards"),{method:"GET",headers:n.headers}).then(o).then((function(e){e.forEach((function(e){i(r,l(e.link,e.name,e._id,e.owner._id,e.likes))}))})).catch((function(e){console.log(e)}))})();